<link rel="import" href="/sys/paper-dialog/paper-dialog.html" />
<link rel="import" href="/sys/juicy-filedrop/juicy-filedrop.html" />

<dom-module id="so-juicy-filedrop">
    <template>
        <style>
            :host {
                display:block;
                height:100%;
                position:relative;
            }

            .container {
                height: 100%;
                width: 100%;
                padding: 0px;
                margin: 0px;
            }

            juicy-filedrop {
                display: block;
                overflow: hidden;
                color: rgb(170, 170, 170);
                border: 0px solid black;
                border: 0px solid #ccc;
                border-radius: 3px;
                height: 100%;
            }

            .drop-file-here {
                border-style: dashed;
                border-color: #A5A5A5;
                background: #EDEDED;
                border-width: 6px;
                height: 100%;
                width: 100%;
                max-height: 100%;
                max-width: 100%;
                text-align: center;
                box-sizing: border-box;
                display:table;
                overflow:hidden;
            }

            .drop-file-here .td {
                display:table-cell;
                vertical-align:middle;
            }

            .img-thumbnail {
                min-height: 50px;
                min-width: 50px;
                height: 100%;
                width: 100%;
                background-size: contain;
                background-position: center center;
                background-repeat: no-repeat;
            }

            .img-border {
                box-sizing: border-box;
                width: 100%;
                height: 100%;
                padding: 4px;
                background-color: #ffffff;
                border: 1px solid #dddddd;
                border-radius: 3px;
            }

            .actions {
                position: absolute;
                right: 4px;
                top: 4px;
                display: none;
            }

            .container:hover .actions {
                display: block;
            }
        </style>
        <div class="container">
            <juicy-filedrop url="{{uploadUrl}}" value="{{value}}" maxfilesize="{{maxFileSize}}" allowedmimetypes="{{allowedMimeTypes}}" id="jfFileDrop">
                <template is="dom-if" if="{{!value}}">
                    <div class="drop-file-here">
                        <div class="td">
                            <span>Drop image here</span>
                            <br />
                            <a href="javascript:" on-click="openFile">Or select file</a>
                        </div>
                    </div>
                </template>
                <template is="dom-if" if="{{value}}">
                    <div class="img-border">
                        <div class="img-thumbnail" style$="{{getStyle(value)}}"></div>
                    </div>
                </template>
            </juicy-filedrop>
            <paper-dialog heading="Error" backdrop="true" layered="true" role="dialog" id="pacAlertDialog">
                <p>{{AlertMessage}}</p>
                <button class="btn btn-default" affirmative role="button" tabindex="1" on-click="closeAlert">Close</button>
            </paper-dialog>
            <div class="actions">
                <content id="content"></content>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: "so-juicy-filedrop",
            properties: {
                uploadUrl: { type: String },
                value: { type: String, notify: true },
                maxFileSize: { type: Number },
                allowedMimeTypes: { type: Array, value: [] },
                openClick: { type: Number, value: 0, observer: "openClickChanged" },
                alertMessage: { type: String }
            },
            isDomReady: false,
            ready: function () {
                var that = this;

                this.isDomReady = true;

                this.$.jfFileDrop.addEventListener("fileUploading", function (e) {
                });

                this.$.jfFileDrop.addEventListener("fileUploaded", function (e) {
                });

                this.$.jfFileDrop.addEventListener("fileUploadError", function (e) {
                    that.openAlert(e.detail.statusText);
                });

                this.$.jfFileDrop.addEventListener("fileSelectError", function (e) {
                    that.openAlert(e.detail.message);
                });
            },
            openFile: function () {
                this.$.jfFileDrop.openFile();
            },
            openAlert: function (message) {
                this.AlertMessage = message;
                this.$.pacAlertDialog.opened = true;
            },
            closeAlert: function () {
                this.AlertMessage = "";
                this.$.pacAlertDialog.opened = false;
            },
            openClickChanged: function () {
                this.openFile();
            },
            getStyle: function (url) {
                return "background-image:url(" + url + ")";
            }
        });
    </script>
</dom-module>