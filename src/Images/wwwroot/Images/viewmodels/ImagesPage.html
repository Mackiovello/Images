<link rel="import" href="/sys/puppet-redirect/puppet-redirect.html" />
<link rel="import" href="/sys/paper-dialog/paper-dialog.html" />

<style>
    .img-illustration {
        max-width:100px;
        max-height:100px;
    }
</style>

<template>
    <template is="dom-bind">
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Mime type</th>
                    <th>ImageURL</th>
                    <th>Preview</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <template is="dom-repeat" items="{{model.Images}}">
                    <tr>
                        <td>{{item.Name}}</td>
                        <td>{{item.MimeType}}</td>
                        <td>{{item.URL}}</td>
                        <td>
                            <a href="{{item.ContentURL}}">
                                <img class="img-illustration img-thumbnail" src="{{item.PreviewURL}}" />
                            </a>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-default" onclick="++this.value;" value="{{item.Delete$::click}}">Delete</button>
                            <a href="{{item.ContentEditURL}}" class="btn btn-sm btn-default">Edit</a>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>
        <button class="btn btn-primary" onclick="++this.value;" value="{{model.Add$::click}}">Add new image</button>
        <link is="puppet-redirect" history url$="{{model.RedirectUrl$}}" />
        <!-- A bug in Polymer: https://github.com/PolymerElements/iron-fit-behavior/issues/13 -->
        <div id="divConfirmDialog" style="position:absolute; top:0; left:0;">
            <paper-dialog id="actions" opened="[[model.Confirm.Message]]" modal="true">
                <div>
                    <h2>Confirmation</h2>
                    <p>{{model.Confirm.Message}}</p>
                </div>
                <div class="buttons">
                    <paper-button class="btn btn-sm btn-default" dialog-dismiss on-click="onConfirmCancelClick">Decline</paper-button>
                    <span>&nbsp;</span>
                    <paper-button class="btn btn-sm btn-primary" dialog-confirm autofocus on-click="onConfirmOkClick">Accept</paper-button>
                </div>
            </paper-dialog>
        </div>
    </template>
    <script>
        (function init(template) {
            template.onConfirmOkClick = function () {
                template.set("model.Confirm.Ok$", template.model.Confirm.Ok$ / 1 + 1);
            };

            template.onConfirmCancelClick = function () {
                template.set("model.Confirm.Reject$", template.model.Confirm.Reject$ / 1 + 1);
            };
        })(document.currentScript.previousElementSibling);
    </script>
</template>
