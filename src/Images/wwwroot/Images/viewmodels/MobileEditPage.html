<link rel="import" href="/Images/elements/so-juicy-filedrop/so-juicy-filedrop.html" />
<link href="/Images/css/standalone.css" rel="stylesheet" />

<template>
    <template is="dom-bind">
        <so-juicy-filedrop on-mousedown="imageClickEvent" session-id="{{model.SessionId}}" upload-url="/images/images" value="{{model.ImageURL$}}" max-file-size="{{model.MaxFileSize}}" allowed-mime-types="{{model.AllowedMimeTypes}}" ismobile="{{'true'}}">
            <template is="dom-if" if="{{model.ImageURL$}}">
                <div>
                    <button class="btn btn-default btn-lg" onclick="++this.value;" value="{{model.Delete$::click}}">Clear</button>
                </div>
            </template>
        </so-juicy-filedrop>
        <div>
            <paper-dialog opened="[[model.IsLightBoxVisible$]]" with-backdrop="true" class="images-preview-image-dialog" on-mousedown="closeEvent" on-iron-overlay-closed="closeEvent">
                <img id="imageThumbnail" src="{{model.ImageURL$}}" class="images-preview-image-dialog-image"/>
            </paper-dialog>
        </div>
    </template>
    <script>
        (function (template) {
            template.closeEvent = function () {
                template.set("model.IsLightBoxVisible$", false);
            }
            template.imageClickEvent = function (e) {
                if (template.model.ImageURL$ && e.target.nodeName == "IMG") {
                    calculateImage();
                    template.set("model.IsLightBoxVisible$", true);
                }
            }
            template.ready = function () {
                window.addEventListener("resize", calculateImage);
            }

            function calculateImage() {
                var img = template.$.imageThumbnail;
                var calculatedImageRatio = img.naturalWidth / img.naturalHeight;
                var calculatedWindowRatio = (window.innerWidth - 30) / (window.innerHeight - 55);

                if (calculatedWindowRatio > calculatedImageRatio) {
                    img.style.height = (window.innerHeight - 60) + 'px';
                    img.parentElement.classList.add('images-preview-image-dialog-fix-size');
                } else {
                    img.style.height = 'auto';
                    img.parentElement.classList.remove('images-preview-image-dialog-fix-size');
                }
            }
        })(document.currentScript.previousElementSibling);
    </script>
</template>
