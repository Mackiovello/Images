<link rel="import" href="/sys/paper-dialog/paper-dialog.html"/>
<link href="/Images/css/standalone.css" rel="stylesheet" />

<template>
    <template is="dom-bind">
        <img src="{{model.Content.URL}}" class="images-preview-image-dialog-image" onmousedown="imageClickEvent(this)" />
        <div>
            <paper-dialog opened="[[model.IsLightBoxVisible$]]" with-backdrop="true" class="images-preview-image-dialog" on-mousedown="closeEvent" on-iron-overlay-closed="closeEvent">
                <img id="imageThumbnail" src="{{model.Content.URL}}" class="images-preview-image-dialog-image" />
            </paper-dialog>
        </div>
    </template>
    <script>
        var globalTemplate;
        function imageClickEvent(e) {
            globalTemplate.imageClickEvent(e);
        }
        (function (template) {
            globalTemplate = template;
            template.closeEvent = function () {
                template.set("model.IsLightBoxVisible$", false);
            }
            template.imageClickEvent = function (e) {
                calculateImage();
                template.set("model.IsLightBoxVisible$", true);
            }
            template.ready = function () {
                window.addEventListener("resize", calculateImage);
            }

            function calculateImage() {
                var img = template.$.imageThumbnail;
                var calculatedImageRatio = img.naturalWidth / img.naturalHeight;
                var calculatedWindowRatio = (window.innerWidth - 30) / (window.innerHeight - 55);

                if (calculatedWindowRatio > calculatedImageRatio) {
                    img.style.height = (window.innerHeight - 60) + 'px';
                    img.parentElement.classList.add('images-preview-image-dialog-fix-size');
                } else {
                    img.style.height = 'auto';
                    img.parentElement.classList.remove('images-preview-image-dialog-fix-size');
                }
            }
        })(document.currentScript.previousElementSibling);
    </script>
</template>