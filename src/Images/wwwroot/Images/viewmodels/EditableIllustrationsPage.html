<link rel="import" href="/Images/elements/so-juicy-filedrop/so-juicy-filedrop.html" />

<template>
    <template is="dom-bind">
        <template is="dom-repeat" items="{{model.Illustrations}}" restamp="true">
            <img slot="Images/thumbnail" src="{{item.PreviewURL}}" onclick="++this.value;" value="{{item.Select$::click}}" />
        </template>
        <button slot="Images/add" onclick="++this.value;" value="{{model.Add$::click}}" class="btn-carousel-add">
            &nbsp;
        </button>
        <so-juicy-filedrop slot="Images/big" id="jfFileDrop" session-id="{{model.SessionId}}" upload-url="/images/images" value="{{model.Selected.Content.URL$}}" filetype="{{model.Selected.Content.MimeType$}}" max-file-size="{{model.MaxFileSize}}" allowed-mime-types="{{model.AllowedMimeTypes}}">
            <div>
                <button class="btn btn-default btn-xs" onclick="++this.value;" value="{{model.Delete$::click}}">Delete</button>
                <template is="dom-if" if="{{model.Selected.Content.URL$}}">
                    <button class="btn btn-primary btn-xs" onclick="++this.value;" value="{{model.Save$::click}}">Save</button>
                </template>
            </div>
        </so-juicy-filedrop>
    </template>
    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            var template = script.previousElementSibling;

            template.addEventListener('dom-change', function () {
                var jf = document.getElementById("jfFileDrop");
                jf.addEventListener("fileUploaded", function (e) {
                    template.set("model.Selected.Content.Name$", e.detail.file.name);
                });
            });
        })();
    </script>
    <template is="starcounter-composition">
        <style>
            @import url("/images/css/illustrations.css");
        </style>
        <div id="images-carousel">
            <div id="images-thumbs">
                <content select="[slot='Images/thumbnail']"></content>
                <div id="images-add">
                    <content select="[slot='Images/add']"></content>
                </div>
            </div>
            <div id="images-big">
                <content select="[slot='Images/big']"></content>
            </div>
        </div>
    </template>
</template>
