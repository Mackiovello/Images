<link rel="import" href="/sys/paper-dialog/paper-dialog.html"/>
<link rel="stylesheet" type="text/css" href="/Images/css/standalone.css"/>

<style>
    .content-image, .content-video, .content-preview {
        min-height: 50px;
        min-width: 50px;
        height: 100%;
        width: 100%;
    }

        .content-image .img-thumbnail {
            min-height: 50px;
            min-width: 50px;
            height: 100%;
            width: 100%;
            background-size: contain;
            background-position: center center;
            background-repeat: no-repeat;
        }
</style>
<template>
    <template is="dom-bind">
        <div slot="images/preview" class="content-preview">
            <template is="dom-if" if="{{model.IsVideo}}" restamp="true">
                <div class="img-border content-video">
                    <div class="video-preview">
                        <div class="cover"></div>
                        <video controls>
                            <source src="{{model.URL}}" type="{{model.MimeType}}">
                            Your browser does not support the video tag for file type
                            <span>{{model.MimeType}}</span>.
                        </video>
                    </div>
                </div>
            </template>
            <template is="dom-if" if="{{!model.IsVideo}}" restamp="true">
                <template is="dom-if" if="{{model.IsImage}}">
                    <div class="img-border content-image" on-mousedown="imageClickEvent">
                        <div class="img-thumbnail" style$="{{getImageStyle(model.URL)}}"></div>
                    </div>
                    <paper-dialog modal="true" opened="[[model.IsLightBoxVisible$]]" with-backdrop="true" class="images-preview-image-dialog" on-mousedown="closeEvent">
                        <img src="{{model.URL}}" class="images-preview-image-dialog-image"/>
                    </paper-dialog>
                </template>
                <template is="dom-if" if="{{!model.IsImage}}">
                    <div class="img-border content-image">
                        <div class="img-thumbnail" style$="{{getFileStyle()}}"></div>
                    </div>
                </template>
            </template>
        </div>
    </template>
    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            var template = script.previousElementSibling;

            template.getImageStyle = function (url) {
                return "background-image:url('" + url + "')";
            };
            template.getFileStyle = function () {
                return "background-image:url('/images/css/file_preview.png')";
            };
            template.closeEvent = function () {
                template.set("model.IsLightBoxVisible$", false);
            }

            template.imageClickEvent = function (e) {
                if (template.model.URL && e.target.nodeName == "DIV") {
                    calculateImage();
                    template.set("model.IsLightBoxVisible$", true);
                }
            }

            function calculateImage() {
                var img = template.parentElement.querySelector('.images-preview-image-dialog-image');
                if (img.naturalWidth && img.naturalHeight) {
                    var calculatedImageRatio = img.naturalWidth / img.naturalHeight;
                    var calculatedWindowRatio = (window.innerWidth - 30) / (window.innerHeight - 55);

                    if (calculatedWindowRatio > calculatedImageRatio) {
                        img.style.height = (window.innerHeight - 60) + 'px';
                        img.parentElement.classList.add('images-preview-image-dialog-fix-size');
                    } else {
                        img.style.height = 'auto';
                        img.parentElement.classList.remove('images-preview-image-dialog-fix-size');
                    }
                }
            }
            window.addEventListener("resize", calculateImage);
        })();
    </script>
    <template is="declarative-shadow-dom">
        <style>
            .content-preview {
                height: 100%;
            }
        </style>
        <div class="content-preview">
            <slot name="images/preview"></slot>
        </div>
    </template>
</template>
